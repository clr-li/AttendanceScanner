<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Home</title>
    <meta name="description" content="A program to automate attendance">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  </head>
  <body>
    <h1 id="header">
      Admin Page 
    </h1>
    <h2 id="businessname"></h2>
    <label for="events">Event: </label>
    <select id="events" name="events"></select>
    <br>
    <button id="scan" onclick="window.open('scanner.html?=')">
      Scanner
    </button><br>
    <button> 
      New Event
    </button>
    <form action="admin.html" get="post">
      <label for="name">Event Name: </label>
      <input type="text" id="name" name="name">
      <label for="description">Description: </label>
      <input type="text" id="description" name="description"><br>
      <label for="startdate">Start Date: </label>
      <input type="date" id="startdate" name="startdate"><br>
      <label for="starttime">Start Date: </label>
      <input type="time" id="starttime" name="starttime"><br>
      <label for="enddate">End Date: </label>
      <input type="date" id="enddate" name="enddate"><br>
      <label for="endtime">End Date: </label>
      <input type="time" id="endtime" name="endtime"><br>
      <input type="submit" value="Submit" id="submitevent">
    </form>
    
    <script>
   document.getElementById('submitevent').onclick = function() {
        name = document.getElementById('name').value;
        description = document.getElementById('description').value;
        startdate = document.getElementById('startdate').value;
        starttime = document.getElementById('starttime').value;
        enddate = document.getElementById('enddate').value;
        endtime = document.getElementById('endtime').value;        
        GET(`/makeEvent?name=${name}&description=${description}&startdate=${startdate}&starttime=${starttime}&enddate=${enddate}&endtime=${endtime}`).then((res) => { console.log(res.status) });
        GET('/businessRow').then((res) => { res.json().then((o) => document.getElementById("businessname").innerHTML += o.Name) });
        GET('/events').then((res) => res.json().then((o) => {
        o.forEach(event => {
          let option = document.createElement('option');
          option.innerHTML = event.name;
          option.id = event.id;
          option.classList.add('event')
          document.getElementById('events').appendChild(option);
        });
      }));
      document.getElementById('scan').onclick = () => {
        let id = -1;
        [...document.getElementsByClassName('event')].forEach((elem) => {
          if (elem.selected) {
            id = elem.id;
          }
        });
        window.open(`scanner.html?eventid=${id}`)
      };
    </script>
  </body>
</html>